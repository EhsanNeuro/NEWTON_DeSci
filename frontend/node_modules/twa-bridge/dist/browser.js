var TwaBridge=function(e){"use strict";var t=function(){return t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},t.apply(this,arguments)};function n(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function r(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}function i(e,t,n){if(n||2===arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}var o=function(){function e(){this.listeners={},this.globalListeners=[]}return e.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.globalListeners.forEach((function(n){return n.apply(void 0,i([e],t,!1))}));var r=this.listeners[e];void 0!==r&&r.forEach((function(e){return e.apply(void 0,t)}))},e.prototype.emitUnsafe=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.emit.apply(this,i([e],t,!1))},e.prototype.on=function(e,t){var n=this.listeners[e];void 0===n?this.listeners[e]=[t]:n.push(t)},e.prototype.off=function(e,t){var n=this.listeners[e];if(void 0!==n){var r=n.indexOf(t);r>=0&&n.splice(r,1)}},e.prototype.subscribe=function(e){this.globalListeners.push(e)},e.prototype.unsubscribe=function(e){var t=this.globalListeners.indexOf(e);t>=0&&this.globalListeners.splice(t,1)},e}();function a(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}var s=function(e){if("number"!=typeof e)throw new TypeError('Unable to parse "'.concat(e,'" as number'));return e},c=function(e){if("string"!=typeof e)throw new TypeError('Unable to parse "'.concat(e,'" as string'));return e},u=function(e){if("boolean"!=typeof e)throw new TypeError('Unable to parse "'.concat(e,'" as boolean'));return e};function p(e,t){return function(n){if(null==n){if(void 0===t)throw new TypeError("Value is empty.");return t()}var r=n;if("string"==typeof r)try{r=JSON.parse(r)}catch(e){throw new TypeError("Value is not JSON object converted to string.")}if(!a(r))throw new TypeError("Value is not JSON object.");var i={};for(var o in e){var s=e[o],c=s[0],u=s[1];try{var p=u(r[c]);void 0!==p&&(i[o]=p)}catch(e){throw new Error('Unable to parse parameter "'.concat(c,'"'),{cause:e})}}return i}}function l(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=new Date,o=Intl.DateTimeFormat(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(r),a=r.getMilliseconds().toString();console[e].apply(console,i(["[".concat(o,".").concat("0".repeat(3-a.length)+a,"]")],t,!1))}function d(e,t){for(var n=e.split("."),r=t.split("."),i=Math.max(n.length,r.length),o=0;o<i;o++){var a=parseInt(n[o]||"0"),s=parseInt(r[o]||"0");if(a!==s)return a>s?1:-1}return 0}var f=p({height:["height",s],width:["width",function(e){return void 0===e?null:s(e)}],is_state_stable:["is_state_stable",u],is_expanded:["is_expanded",u]}),v=p({theme_params:["theme_params",function(e){if(!a(e))throw new TypeError('Unable to parse "'.concat(e,'" as Record'));return e}]});var h,g=p({button_id:["button_id",function(e){return null==e?void 0:c(e)}]}),b=p({data:["data",function(e){return void 0===e?e:c(e)}]}),w=p({slug:["slug",c],status:["status",c]}),_=p({req_id:["req_id",c],data:["data",function(e){return null==e?e:c(e)}]}),y=p({type:["eventType",c],data:["eventData",function(e){return e}]});function m(e){if(void 0===e&&(e=!1),void 0===h){var t=new o,n=function(t){for(var n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];e&&l.apply(void 0,r([t,"[Bridge]"],n,!1))};window.addEventListener("message",(function(e){var r;if(n("log","message event received",e),e instanceof MessageEvent){if(e.source!==window.parent||"string"!=typeof e.data)return n("log","event rejected",e);r=e.data}else{if(!(e instanceof CustomEvent&&a(e.detail)&&"string"==typeof e.detail.eventType&&"eventData"in e.detail))return n("warn","event was skipped",e);r=e.detail}try{var i=y(r),o=i.type,s=i.data;t.emit("message",o,s)}catch(e){n("error","event data extraction error",r,e)}})),window.addEventListener("resize",(function(){var e={width:window.innerWidth,height:window.innerHeight,is_state_stable:!0,is_expanded:!0};t.emit("message","viewport_changed",e)})),h=t}return h}var E=!1;function O(e){if(void 0===e&&(e=!1),!E||e){var t=window;[["TelegramGameProxy_receiveEvent"],["TelegramGameProxy","receiveEvent"],["Telegram","WebView","receiveEvent"]].forEach((function(e){var n=t;e.forEach((function(e,t,r){t!==r.length-1?(e in n||(n[e]={}),n=n[e]):n[e]=function(e,t){window.dispatchEvent(new CustomEvent("message",{detail:{eventType:e,eventData:t}}))}}))})),E=!0}}function x(e){return void 0!==e.TelegramWebviewProxy}function T(e){return"external"in e&&"function"==typeof e.external.notify}function j(){try{return window.self!==window.top}catch(e){return!0}}function U(e,t,n){if(void 0===t&&(t=""),void 0===n&&(n={}),j())return window.parent.postMessage(JSON.stringify({eventType:e,eventData:t}),n.targetOrigin||"https://web.telegram.org");if(x(window))return window.TelegramWebviewProxy.postEvent(e,JSON.stringify(t));if(T(window))return window.external.notify(JSON.stringify({eventType:e,eventData:t}));throw new Error("Unable to determine current environment and possible way to send event.")}var P=function(){function e(e){void 0===e&&(e={});var i=this;this._boundEmitter=null,this.ee=new o,this.emit=function(e){for(var t,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];i.log.apply(i,r(["log","[emit]",e],n,!1)),(t=i.ee).emit.apply(t,r([e],n,!1))},this.emitUnsafe=function(e){for(var t,n=[],o=1;o<arguments.length;o++)n[o-1]=arguments[o];i.log.apply(i,r(["log","[emitUnsafe]",e],n,!1)),(t=i.ee).emitUnsafe.apply(t,r([e],n,!1))},this.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];i.debug&&l.apply(void 0,r([e,"[Bridge]"],t,!1))},this.processEvent=function(e,r){i.log("log","[processEvent]",e,r);try{switch(e){case"viewport_changed":return i.emit(e,function(e){var r=f(e),i=r.width,o=n(r,["width"]);return t(t({},o),{width:null===i?window.innerWidth:i})}(r));case"theme_changed":return i.emit(e,v(r));case"popup_closed":return null==r?i.emit(e,{}):i.emit(e,g(r));case"set_custom_style":return i.emit(e,c(r));case"qr_text_received":return i.emit(e,b(r));case"main_button_pressed":case"back_button_pressed":case"settings_button_pressed":case"scan_qr_popup_closed":return i.emit(e);case"clipboard_text_received":return i.emit(e,_(r));case"invoice_closed":return i.emit(e,w(r));default:return i.emitUnsafe(e,r)}}catch(e){throw i.log("error","[processEvent] error",e),e}},this.on=this.ee.on.bind(this.ee),this.off=this.ee.off.bind(this.ee),this.postEvent=function(e,r,o){var a=o||{},s=a.targetOrigin,c=void 0===s?i.targetOrigin:s,u=n(a,["targetOrigin"]);U(e,r,t(t({},u),{targetOrigin:c})),i.log("log","[postEvent]",e,r)},this.subscribe=this.ee.subscribe.bind(this.ee),this.unsubscribe=this.ee.unsubscribe.bind(this.ee);var a=e.debug,s=void 0!==a&&a,u=e.emitter,p=void 0===u?null:u,d=e.targetOrigin,h=void 0===d?"https://web.telegram.org":d;this.debug=s,this.targetOrigin=h,this.boundEmitter=p}return Object.defineProperty(e.prototype,"boundEmitter",{get:function(){return this._boundEmitter||null},set:function(e){null!==this._boundEmitter&&this._boundEmitter.off("message",this.processEvent),this._boundEmitter=e,null!==this._boundEmitter&&this._boundEmitter.on("message",this.processEvent)},enumerable:!1,configurable:!0}),e.prototype.bind=function(e){this.boundEmitter=e},e.prototype.unbind=function(){this.boundEmitter=null},e}();return e.Bridge=P,e.defineEventReceiver=O,e.getGlobalEventEmitter=m,e.init=function(e){void 0===e&&(e={});var r=e.defineReceiver,i=void 0===r||r,o=e.emitter,a=void 0===o?m():o,s=n(e,["defineReceiver","emitter"]);return i&&O(),new P(t(t({},s),{emitter:a}))},e.isBrowserEnv=j,e.isDesktopOrMobileEnv=x,e.isWindowsPhoneEnv=T,e.postEvent=U,e.supports=function(e,t){switch(e){case"web_app_open_tg_link":case"web_app_open_invoice":case"web_app_setup_back_button":case"web_app_set_background_color":case"web_app_set_header_color":case"web_app_trigger_haptic_feedback":return d("6.1",t)<=0;case"web_app_open_popup":return d("6.2",t)<=0;case"web_app_close_scan_qr_popup":case"web_app_open_scan_qr_popup":case"web_app_read_text_from_clipboard":return d("6.4",t)<=0;default:return!0}},e}({});
